<html>
	<body>
		<label>size</label><input id='size' type="number" name="" value="50"><br/>
		<label>Generation</label><input id='gen' type="number" name="" value="7"><br/>
		<input id='sizeLrg' type="button" text="Larger" value="Larger">
		<input id='sizeSml' type="button" text="Smaller" value = "Smaller">
		<canvas id="canvas" height="1000" width="1000">			
		</canvas>
	</body>
</html>
<script>
var params= {}	;
var generations = [];
var generation = 0;
var ctx = document.getElementById('canvas').getContext('2d');
var size = 50;
(function(){
	document.getElementById('size').value = 100;
	document.getElementById('size').addEventListener('change', draw);
	document.getElementById('gen').addEventListener('change', draw);
	document.getElementById('sizeLrg').addEventListener('click', sizeLarger);
	document.getElementById('sizeSml').addEventListener('click', sizeSmaller);

})();

function sizeLarger(){
	size+=100;
	draw();
}
function sizeSmaller(){
	size-=100;
	draw();
}
function draw(){

	var convas = document.getElementById('canvas');
	ctx.clearRect(0, 0, canvas.width, canvas.height);
	params.start = {};
	params.start.x = 100;
	params.start.y = 100;

	fractalSnowFlake = {};
	fractalSnowFlake.gen = [];
	//var size = document.getElementById('size').value;
	fractalSnowFlake.gen[1] = [{x:120,y:size},{x:120,y:size},{x:120,y:size}];
	fractalSnowFlake.fractalize = function(frac, gen){
	if(frac.gen[gen]===undefined)
		return [];

		var oldPoints = frac.gen[gen];
		var newPoints = [];
		// iterate points in this gen one at a time to make the new gen
		for(i=0;i<oldPoints.length;i++)
		{
			var p1 = oldPoints[i];			
			var newPointsTemp = frac.nextGen(p1);

			newPointsTemp.forEach(function(p){
				newPoints.push(p);
			})
			
		}
		return newPoints;
	}
	fractalSnowFlake.nextGen=function(p1){
		//take 2 points, return the 5 points
		var points = [];
		var length1 = p1.y;
		var angle = p1.x;
		var qlen = length1/3.0;
		points[0] = {x:angle,y:qlen}; // 120
		points[1] = {x:-60,y:qlen};	// -60
		points[2] = {x:120,y:qlen}; // 120
		points[3] = {x:-60,y:qlen}; // -60
		return points;
	}
	fractalSnowFlake.drawGeneration=function(frac, gen){
		if(frac.gen[gen]===undefined)
			getGen(frac, gen);
		var points = frac.gen[gen];
		
		var rotation = 0;
		for(var i=0;i<points.length;i++){

			ctx.beginPath();
			ctx.lineTo(0,0);
			rotation=0;
			rotation += (-points[i].x*Math.PI/180);
			ctx.rotate(rotation);
			ctx.lineTo(points[i].y,0);

			var red = getRandomInt(256);
			var blue = getRandomInt(256);
			var green = getRandomInt(256);

			ctx.strokeStyle="#"+red.toString(16)+blue.toString(16)+green.toString(16);

			ctx.translate(points[i].y,0);
			ctx.stroke();
		}
	}


	factalTriangle = {};
	factalTriangle.gen = [];
	//var size = document.getElementById('size').value;
	factalTriangle.gen[1] = [{x:120,y:size},{x:120,y:size},{x:120,y:size}];
	factalTriangle.fractalize = function(frac, gen){
		if(frac.gen[gen]===undefined)
			return [];

		var oldPoints = frac.gen[gen];
		var newPoints = [];
		// iterate points in this gen three at a time to make the new gen
		for(i=0;i<oldPoints.length;i+=3)
		{
			var p1 = oldPoints[i];
			var p2 = oldPoints[i+1];
			var p3 = oldPoints[i+2];			
			var newPointsTemp = frac.nextGen(p1,p2,p3);

			newPointsTemp.forEach(function(p){
				newPoints.push(p);
			})
		}
		return newPoints;
	}
	factalTriangle.nextGen=function(p1,p2,p3){
		//take 2 points, return the 5 points
		var points = [];
		var length1 = p1.y;
		var angle = p1.x;
		var qlen = length1/2.0;
		//turn one triangle into three (top, bl, br)
		points[0] = {x:p1.x+120,y:qlen}; //
		points[1] = {x:120,y:qlen};	//
		points[2] = {x:120,y:qlen}; // 

		points[3] = {x:120,y:qlen}; // position
		
		points[4] = {x:0,y:qlen};	//
		points[5] = {x:120,y:qlen}; // 
		points[6] = {x:120,y:qlen}; //

		points[7] = {x:240,y:qlen};	// position

		points[8] = {x:240,y:qlen}; //
		points[9] = {x:120,y:qlen}; //
		points[10] = {x:120,y:qlen};	//

		points[11] = {x:90,y:qlen};	// dummy

		return points;
	}
	factalTriangle.drawGeneration=function(frac, gen){
		if(frac.gen[gen]===undefined)
			getGen(frac, gen);
		var points = frac.gen[gen];
		
		var rotation = 0;
		for(var i=0;i<points.length;i++){

			ctx.beginPath();
			ctx.lineTo(0,0);
			rotation=0;
			rotation += (-points[i].x*Math.PI/180);
			ctx.rotate(rotation);
			ctx.lineTo(points[i].y,0);

			var red = getRandomInt(256);
			var blue = getRandomInt(256);
			var green = getRandomInt(256);

			ctx.strokeStyle="#"+red.toString(16)+blue.toString(16)+green.toString(16);

			ctx.translate(points[i].y,0);
			ctx.stroke();
		}
	}

	center = {};
	center.x = size*1.0;
	center.y = size*1.0;

	ctx.translate(center.x,center.y);
	var gen = document.getElementById('gen').value;
	for(gen=gen;gen>0;gen--)
		factalTriangle.drawGeneration(fractalSnowFlake, gen);
	
	ctx.translate(-center.x,-center.y);
}

function getGen(frac, gen){	
	if(frac.gen[gen-1] === undefined)
		getGen(frac, gen-1);
	frac.gen[gen] = frac.fractalize(frac, gen-1);
}

function getRandomInt(max) {
  return Math.floor(Math.random() * Math.floor(max));
}

</script>